<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 520">
  <defs>
    <style>
      .relation-box { fill: #f8f9fa; stroke: #2c3e50; stroke-width: 2; }
      .pk-attr { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; font-weight: bold; }
      .attr { fill: #fff; stroke: #607d8b; stroke-width: 1.5; }
      .intermediary-attr { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
      .arrow { stroke: #e74c3c; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-direct { stroke: #4caf50; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead-direct); }
      .arrow-transitive { stroke: #ff5722; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead-transitive); stroke-dasharray: 8,4; }
      .line { stroke: #e74c3c; stroke-width: 2; fill: none; }
      .line-direct { stroke: #4caf50; stroke-width: 2.5; fill: none; }
      .line-transitive { stroke: #ff5722; stroke-width: 2.5; fill: none; stroke-dasharray: 8,4; }
      .text { font-family: 'Segoe UI', Arial, sans-serif; font-size: 14px; fill: #2c3e50; }
      .title { font-family: 'Segoe UI', Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #2c3e50; }
      .label { font-size: 12px; fill: #7f8c8d; }
      .warning { font-size: 12px; fill: #ff5722; font-weight: bold; }
      .success { font-size: 12px; fill: #4caf50; font-weight: bold; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#e74c3c" />
    </marker>
    <marker id="arrowhead-direct" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#4caf50" />
    </marker>
    <marker id="arrowhead-transitive" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#ff5722" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" class="title" style="font-size: 18px;">Third Normal Form (3NF): No Transitive Dependencies</text>

  <!-- VIOLATION: employees with transitive dependency -->
  <g id="violation">
    <text x="400" y="65" text-anchor="middle" class="title" style="fill: #c62828;">X Violation: Non-key attribute depends on another non-key attribute</text>

    <!-- Outer box -->
    <rect x="50" y="85" width="700" height="160" class="relation-box" rx="5"/>
    <text x="400" y="110" text-anchor="middle" class="title">employees</text>

    <!-- Attributes in one row -->
    <!-- Primary Key -->
    <rect x="70" y="190" width="70" height="30" class="pk-attr" rx="3"/>
    <text x="105" y="210" text-anchor="middle" class="text">emp_id</text>

    <!-- Direct dependents -->
    <rect x="150" y="190" width="70" height="30" class="attr" rx="3"/>
    <text x="185" y="210" text-anchor="middle" class="text">name</text>

    <!-- Intermediary (problem attribute) -->
    <rect x="230" y="190" width="70" height="30" class="intermediary-attr" rx="3"/>
    <text x="265" y="210" text-anchor="middle" class="text">dept_id</text>

    <!-- Transitively dependent attributes -->
    <rect x="310" y="190" width="90" height="30" class="attr" rx="3"/>
    <text x="355" y="210" text-anchor="middle" class="text">dept_name</text>

    <rect x="410" y="190" width="105" height="30" class="attr" rx="3"/>
    <text x="462.5" y="210" text-anchor="middle" class="text">dept_building</text>

    <!-- Direct dependency: emp_id → name -->
    <line x1="105" y1="190" x2="105" y2="140" class="line-direct"/>
    <line x1="105" y1="140" x2="185" y2="140" class="line-direct"/>
    <path d="M 185 140 L 185 190" class="arrow-direct"/>
    <text x="145" y="135" text-anchor="middle" class="success">OK Direct</text>

    <!-- Direct dependency: emp_id → dept_id -->
    <line x1="105" y1="190" x2="105" y2="150" class="line-direct"/>
    <line x1="105" y1="150" x2="265" y2="150" class="line-direct"/>
    <path d="M 265 150 L 265 190" class="arrow-direct"/>
    <text x="185" y="145" text-anchor="middle" class="success">OK Direct</text>

    <!-- Transitive chain: dept_id → dept_name, dept_building -->
    <line x1="265" y1="190" x2="265" y2="160" class="line-transitive"/>
    <line x1="265" y1="160" x2="462.5" y2="160" class="line-transitive"/>
    <path d="M 355 160 L 355 190" class="arrow-transitive"/>
    <path d="M 462.5 160 L 462.5 190" class="arrow-transitive"/>
    <text x="363.5" y="155" text-anchor="middle" class="warning">! TRANSITIVE (non-key → non-key)</text>

    <!-- Annotation showing the chain -->
    <text x="400" y="235" text-anchor="middle" class="label" style="font-style: italic;">
      Transitive chain: emp_id → dept_id → dept_name, dept_building
    </text>
  </g>

  <!-- Explanation -->
  <g id="explanation">
    <rect x="50" y="260" width="700" height="75" style="fill: #ffebee; stroke: #c62828; stroke-width: 2;" rx="5"/>

    <text x="70" y="285" class="text" style="font-weight: bold; fill: #b71c1c;">Why this violates 3NF:</text>
    <text x="70" y="305" class="label">• <tspan style="fill: #f57c00; font-weight: bold;">dept_id</tspan> is a non-key attribute (not part of the primary key)</text>
    <text x="70" y="322" class="label">• But <tspan style="fill: #ff5722; font-weight: bold;">dept_name</tspan> and <tspan style="fill: #ff5722; font-weight: bold;">dept_building</tspan> depend on <tspan style="fill: #f57c00; font-weight: bold;">dept_id</tspan>, not directly on <tspan style="fill: #1976d2; font-weight: bold;">emp_id</tspan></text>
  </g>

  <!-- SOLUTION: Decomposed tables -->
  <g id="solution">
    <text x="400" y="365" text-anchor="middle" class="title" style="fill: #2e7d32;">OK Solution: Decompose into 2 tables (each in 3NF)</text>

    <!-- employees table (cleaned) -->
    <g>
      <rect x="100" y="385" width="250" height="100" class="relation-box" rx="5"/>
      <text x="225" y="405" text-anchor="middle" class="title" style="font-size: 14px;">employees</text>

      <rect x="115" y="435" width="70" height="25" class="pk-attr" rx="3"/>
      <text x="150" y="452" text-anchor="middle" class="text" style="font-size: 13px;">emp_id</text>

      <rect x="195" y="435" width="70" height="25" class="attr" rx="3"/>
      <text x="230" y="452" text-anchor="middle" class="text" style="font-size: 13px;">name</text>

      <rect x="275" y="435" width="65" height="25" class="attr" rx="3"/>
      <text x="307.5" y="452" text-anchor="middle" class="text" style="font-size: 13px;">dept_id</text>

      <line x1="150" y1="435" x2="150" y2="420" class="line"/>
      <line x1="150" y1="420" x2="320" y2="420" class="line"/>
      <path d="M 230 420 L 230 435" class="arrow"/>
      <path d="M 307.5 420 L 307.5 435" class="arrow"/>

      <text x="225" y="475" text-anchor="middle" class="label" style="font-size: 10px;">dept_id is FK to departments</text>
    </g>

    <!-- departments table -->
    <g>
      <rect x="450" y="385" width="300" height="100" class="relation-box" rx="5"/>
      <text x="600" y="405" text-anchor="middle" class="title" style="font-size: 14px;">departments</text>

      <rect x="465" y="435" width="70" height="25" class="pk-attr" rx="3"/>
      <text x="500" y="452" text-anchor="middle" class="text" style="font-size: 13px;">dept_id</text>

      <rect x="545" y="435" width="90" height="25" class="attr" rx="3"/>
      <text x="590" y="452" text-anchor="middle" class="text" style="font-size: 13px;">dept_name</text>

      <rect x="645" y="435" width="95" height="25" class="attr" rx="3"/>
      <text x="692.5" y="452" text-anchor="middle" class="text" style="font-size: 12px;">dept_building</text>

      <line x1="500" y1="435" x2="500" y2="420" class="line"/>
      <line x1="500" y1="420" x2="692.5" y2="420" class="line"/>
      <path d="M 590 420 L 590 435" class="arrow"/>
      <path d="M 692.5 420 L 692.5 435" class="arrow"/>
    </g>
  </g>

  <!-- Key Insight -->
  <g id="insight">
    <text x="400" y="510" text-anchor="middle" class="label" style="font-weight: bold; fill: #1976d2;">
      Key: In 3NF, non-key attributes must depend ONLY on the primary key, not on other non-key attributes
    </text>
  </g>
</svg>
